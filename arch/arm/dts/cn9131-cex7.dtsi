/*
* Copyright (C) 2020 SolidRun ltd.
*
* SPDX-License-Identifier:    GPL-2.0
* https://spdx.org/licenses
*/

/* Device Tree file for the SolidRun cn1931 based com express type 7, cp1  */

#undef CP110_NAME
#undef CP110_NUM
#undef CP110_PCIE_MEM_SIZE
#undef CP110_PCIEx_CPU_MEM_BASE
#undef CP110_PCIEx_BUS_MEM_BASE

/* CP110-1 Settings */
#define CP110_NAME                     cp1
#define CP110_NUM                      1
#define CP110_PCIE_MEM_SIZE(iface)     (0xf00000)
#define CP110_PCIEx_CPU_MEM_BASE(iface)        (0xe2000000 + (iface) * 0x1000000)
#define CP110_PCIEx_BUS_MEM_BASE(iface)        (CP110_PCIEx_CPU_MEM_BASE(iface))

#include "armada-cp110.dtsi"

/ {
       model = "SolidRun CN9131 based COM express type 7";
       compatible = "marvell,cn9131-db";

       aliases {
               gpio3 = &cp1_gpio0;
               gpio4 = &cp1_gpio1;
               fuse5 = &cp1_ld_efuse0; /* bank 68 RO */
               fuse6 = &cp1_ld_efuse1; /* bank 69 RW */
       };

};

&cp1_ld_efuse0 {
       status = "okay";
};

&cp1_ld_efuse1 {
       status = "okay";
};

&cp1_i2c1 {
       pinctrl-names = "default";
       pinctrl-0 = <&cp1_i2c1_pins>;
       status = "okay";
       clock-frequency = <100000>;
};

&cp1_xmdio {
        status = "okay";
	pinctrl-0 = <&cp1_xmdio_pins>;
	sfi_phy_cp1_0: ethernet-phy@0 {
                reg = <0>;
        };

};


&cp1_pcie0 {
       pinctrl-names = "default";
       status = "okay";
       num-lanes = <2>;
               /* non-prefetchable memory */
       ranges = <0x82000000 0 0xe2000000 0 0xe2000000 0 0xf00000>;
};

&cp1_pinctl {
       compatible = "marvell,mvebu-pinctrl",
                    "marvell,cp115-standalone-pinctrl";
       bank-name ="cp1-110";

       /* MPP Bus:
	*	[0-10]	NC
	*	[11]	GPIO - BATLOW_N serves as LED_IO1 on clearfog
	*	[12]	GPIO - SPKR
	*	[13-16]	SPI TPM
	*	[17]	GPIO - TPM_PIRQ_N
	*	[18-23]	boot straps
	*	[24-27]	NC
	*	[28-30]	PTP
	*	[31,32]	NC
	*	[33]	GPIO - THERMTRIP_N
	*	[34]	GPIO - THERM_N
	*	[35,36]	I2C1
	*	[37,38]	xmdio - connected to phy 88e2110
	*	[39]	sata_act
	*	[40]	GPIO - sw rerout push cutton
	*	[41]	NC
	*	[42,43]	GPIOs - wireless disable wifi0, wifi1
	*	[44-49]	NC
	*	[50]	GPIO - SFP_INT_CP1
	*	[51]	GPIO - wake1
	*	[52]	RCVR - recovered clock
	*	[53-62]	NC
	*/
               /*      0    1    2    3    4    5    6    7    8    9 */
       pin-func = <    0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0  0x3  0x3  0x3  0x3  0x0  0x0  0x0
                       0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x7  0x7
                       0x7  0x0  0x0  0x0  0x2  0x2  0x2  0x8  0x8  0x9
                       0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x2  0x0  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0 >;

       cp1_xmdio_pins: cp1-xmdio-pins-0 {
               marvell,pins = < 37 38 >;
               marvell,function = <8>;
       };
       cp1_i2c1_pins: cp1-i2c-pins-1 {
               marvell,pins = < 35 36 >;
               marvell,function = <2>;
       };

       cp1_spi0_pins: cp1-spi-pins-0 {
               marvell,pins = < 13 14 15 16 >;
               marvell,function = <3>;
       };

};

/* SATA0  */
&cp1_sata0 {
       status = "okay";
};

/* SPI TPM */
&cp1_spi1 {
       pinctrl-names = "default";
       pinctrl-0 = <&cp1_spi0_pins>;
       reg = <0x700680 0x50>,          /* control */
             <0x2000000 0x1000000>,    /* CS0 */
             <0 0xffffffff>,           /* CS1 */
             <0 0xffffffff>,           /* CS2 */
             <0 0xffffffff>;           /* CS3 */
       status = "okay";
};

&cp1_ethernet {
        status = "okay";
};

&cp1_eth0 {
        status = "okay";
        phy-mode = "sfi";
        phy = <&sfi_phy_cp1_0>;
};

&cp1_pcie0 {
        num-lanes = <2>;
        status = "okay";
};

&cp1_pcie1 {
        num-lanes = <1>;
        status = "okay";
};

&cp1_pcie2 {
        num-lanes = <2>;
        status = "okay";
};
