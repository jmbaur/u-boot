/*
* Copyright (C) 2020 SolidRun ltd.
*
* SPDX-License-Identifier:    GPL-2.0
* https://spdx.org/licenses
*/

/* Device Tree file for the cn1931 based belden mbv carrier board, cp1  */

#undef CP110_NAME
#undef CP110_NUM
#undef CP110_PCIE_MEM_SIZE
#undef CP110_PCIEx_CPU_MEM_BASE
#undef CP110_PCIEx_BUS_MEM_BASE

/* CP110-1 Settings */
#define CP110_NAME                     cp1
#define CP110_NUM                      1
#define CP110_PCIE_MEM_SIZE(iface)     (0xf00000)
#define CP110_PCIEx_CPU_MEM_BASE(iface)        (0xe2000000 + (iface) * 0x1000000)
#define CP110_PCIEx_BUS_MEM_BASE(iface)        (CP110_PCIEx_CPU_MEM_BASE(iface))

#include "armada-cp110.dtsi"

/ {
	model = "SolidRun CN9131 based SolidWan";
	compatible = "marvell,cn9131-db";

	aliases {
		gpio3 = &cp1_gpio0;
		gpio4 = &cp1_gpio1;
		fuse5 = &cp1_ld_efuse0; /* bank 68 RO */
		fuse6 = &cp1_ld_efuse1; /* bank 69 RW */
	};

	cp1 {
		config-space {
			cp1_reg_usb3_vbus0: cp1_usb3_vbus@0 {
				compatible = "regulator-fixed";
				pinctrl-names = "default";
				//pinctrl-0 = <&cp1_xhci0_vbus_pins>;
				regulator-name = "cp1-xhci0-vbus";
				regulator-min-microvolt = <5000000>;
				regulator-max-microvolt = <5000000>;
				startup-delay-us = <100000>;
				regulator-force-boot-off;
				//gpio = <&cp1_gpio0 5 GPIO_ACTIVE_HIGH>;
			};

			cp1_reg_usb3_vbus1: cp1_usb3_vbus@0 {
				compatible = "regulator-fixed";
				pinctrl-names = "default";
				//pinctrl-0 = <&cp1_xhci0_vbus_pins>;
				regulator-name = "cp1-xhci0-vbus";
				regulator-min-microvolt = <5000000>;
				regulator-max-microvolt = <5000000>;
				startup-delay-us = <100000>;
				regulator-force-boot-off;
				//gpio = <&cp1_gpio0 5 GPIO_ACTIVE_HIGH>;
			};

			cp1_reg_usb3_current_lim0: cp1_usb3_current_limiter@0 {
				compatible = "regulator-fixed";
				regulator-min-microamp = <900000>;
				regulator-max-microamp = <900000>;
				regulator-force-boot-off;
				gpio = <&cp1_gpio0 5 GPIO_ACTIVE_HIGH>;
			};
		};
	};
};
&cp1_ld_efuse0 {
 status = "disabled";
};

&cp1_ld_efuse1 {
 status = "disabled";
};

&cp1_i2c1 {
	pinctrl-names = "default";
	pinctrl-0 = <&cp1_i2c1_pins>;
	clock-frequency = <100000>;
	status = "okay";
};


&cp1_utmi0 {
	status = "okay";
};
&cp1_utmi1 {
	status = "okay";
};
/*
&cp1_usb3_1 {
	status = "okay";
	vbus-supply = <&cp1_reg_usb3_vbus1>;
};
*/
&cp1_pcie0 {
	pinctrl-names = "default";
	num-lanes = <1>;
	/* non-prefetchable memory */
	ranges = <0x82000000 0 0xe2000000 0 0xe2000000 0 0xf00000>;
	//pinctrl-names = "default";
	//marvell,reset-gpio = <&cp1_gpio0 29 GPIO_ACTIVE_LOW>;
	status = "okay";
};

&cp1_pinctl {
	compatible = "marvell,mvebu-pinctrl",
				 "marvell,cp115-standalone-pinctrl";
	bank-name ="cp1-110";

	/* MPP Bus:
	*	[1:0]	UART0
	*	[29:2]	NC
	*	[30:29] GPIO - M.2 Power off
	*	[32:31]	NC
	*	[34:33] SFP GPIOs
	*	[36:35] I2C
	*	[38:37]	SMI
	*	[41:40]	UART1
	*	[48:42]	NC
	*	[50:49] SFP GPIOs
	*	[62:51]	NC
	*/
	/*			 0    1    2    3    4    5    6    7    8    9 */
	pin-func = < 0x8  0x8  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
				 0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
				 0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
				 0x0  0x0  0x0  0x0  0x0  0x2  0x2  0x7  0x7  0x0
				 0x7  0x7  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
				 0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
				 0x0  0x0  0x0 >;

	cp1_uart0_pins: cp1-uart0-pins-1 {
		marvell,pins = < 0 1 >;
		marvell,function = <8>;
	};

	cp1_uart1_pins: cp1-uart1-pins-1 {
		marvell,pins = < 40 41 >;
		marvell,function = <7>;
	};

	cp1_i2c1_pins: cp1-i2c-pins-1 {
		marvell,pins = < 35 36 >;
		marvell,function = <2>;
	};

	cp1_mdio_pins: cp1-mdio-pins {
		marvell,pins = < 37 38 >;
		marvell,function = <7>;
	};
};

&cp1_mdio2 {
	pinctrl-0 = <&cp1_mdio_pins>;
	status = "okay";

	cp1_phy0: ethernet-phy@0 {
		marvell,reg-init = <3 16 0 0x1017>;
		reg = <0>;
	};

	cp1_phy1: ethernet-phy@1 {
		marvell,reg-init = <3 16 0 0x1017>;
		reg = <1>;
	};
};

/* SATA0  */
&cp1_sata0 {
	status = "okay";
};

&cp1_ethernet {
	status = "okay";
};

&cp1_eth0 {
	phy-mode = "sfi";
	compatible = "sff,sfp";
	i2c-bus = <&cp1_i2c1>;
	los-gpio = <&cp1_gpio1 2 GPIO_ACTIVE_HIGH>; //MPP34
	mod-def0-gpio = <&cp1_gpio1 18 GPIO_ACTIVE_LOW>; //MPP50
	tx-disable-gpio = <&cp1_gpio1 1 GPIO_ACTIVE_HIGH>; //MPP33
	tx-fault-gpio = <&cp1_gpio1 17 GPIO_ACTIVE_HIGH>; //MPP49
	maximum-power-milliwatt = <2000>;
	status = "okay";
};

/* SERDES 3 SGMII */
&cp1_eth1 {
	phy-mode = "sgmii";
	phy = <&cp1_phy0>;
	/*
	 * All Carrier PHYs share single reset line
	 * phy-reset-gpios = <&cp0_gpio1 7 GPIO_ACTIVE_LOW>; // MPP39
	 */
	status = "okay";
};

/* SERDES 5 SGMII */
&cp1_eth2 {
	phy-mode = "sgmii";
	phy = <&cp1_phy1>;
	/*
	 * All Carrier PHYs share single reset line
	 * phy-reset-gpios = <&cp0_gpio1 7 GPIO_ACTIVE_LOW>; // MPP39
	 */
	status = "okay";
};

/* M.2 LTE USB */
&cp1_usb3_0 {
	vbus-supply = <&cp1_reg_usb3_vbus0>;
	status = "okay";
};
