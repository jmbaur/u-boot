/*
* Copyright (C) 2020 SolidRun ltd.
*
* SPDX-License-Identifier:    GPL-2.0
* https://spdx.org/licenses
*/

/* Device Tree file for the cn1931 based belden mbv carrier board, cp1  */

#undef CP110_NAME
#undef CP110_NUM
#undef CP110_PCIE_MEM_SIZE
#undef CP110_PCIEx_CPU_MEM_BASE
#undef CP110_PCIEx_BUS_MEM_BASE

/* CP110-1 Settings */
#define CP110_NAME                     cp1
#define CP110_NUM                      1
#define CP110_PCIE_MEM_SIZE(iface)     (0xf00000)
#define CP110_PCIEx_CPU_MEM_BASE(iface)        (0xe2000000 + (iface) * 0x1000000)
#define CP110_PCIEx_BUS_MEM_BASE(iface)        (CP110_PCIEx_CPU_MEM_BASE(iface))

#include "armada-cp110.dtsi"
/ {
       model = "Belden CN9131 based MBV-A/B";
       compatible = "marvell,cn9131-db";

       aliases {
               gpio3 = &cp1_gpio0;
               gpio4 = &cp1_gpio1;
               // fuse5 = &cp1_ld_efuse0; /* bank 68 RO */
               // fuse6 = &cp1_ld_efuse1; /* bank 69 RW */
       };
	cp1 {
                config-space {
                        cp1_reg_usb3_vbus0: cp1_usb3_vbus@0 {
                                compatible = "regulator-fixed";
                                pinctrl-names = "default";
                                regulator-name = "cp1-xhci0-vbus";
                                regulator-min-microvolt = <5000000>;
                                regulator-max-microvolt = <5000000>;
                                startup-delay-us = <100000>;
                                regulator-force-boot-off;
                        };
                        cp1_reg_usb3_vbus1: cp1_usb3_vbus@0 {
                                compatible = "regulator-fixed";
                                pinctrl-names = "default";
                                regulator-name = "cp1-xhci0-vbus";
                                regulator-min-microvolt = <5000000>;
                                regulator-max-microvolt = <5000000>;
                                startup-delay-us = <100000>;
                                regulator-force-boot-off;
                        };

                        cp1_reg_usb3_current_lim0: cp1_usb3_current_limiter@0 {
                                compatible = "regulator-fixed";
                                regulator-min-microamp = <900000>;
                                regulator-max-microamp = <900000>;
                                regulator-force-boot-off;
                        };
                };
        };
};

// &cp1_ld_efuse0 {
//        status = "disabled";
// };
//
// &cp1_ld_efuse1 {
//        status = "disabled";
// };

&cp1_i2c1 {
       pinctrl-names = "default";
       pinctrl-0 = <&cp1_i2c1_pins>;
       status = "okay";
       clock-frequency = <100000>;
};

&cp1_utmi0 {
        status = "okay";
};
&cp1_utmi1 {
        status = "okay";
};

&cp1_usb3_0 {
        status = "disabled";
};

&cp1_xmdio {
        status = "okay";
        pinctrl-0 = <&cp1_xmdio_pins>;
	cp0_sfi_phy8: ethernet-phy@8 {
                reg = <8>;
        };
	cp1_sfi_phy9: ethernet-phy@9 {
                reg = <9>;
        };
};

&cp1_mdio {
        status = "okay";
        pinctrl-0 = <&cp1_mdio_pins>;
        cp0_vsc_phy18: ethernet-phy@18 {
                reg = <18>;
        };
	cp0_vsc_phy19: ethernet-phy@19 {
                reg = <19>;
        };
};


&cp1_pinctl {
       compatible = "marvell,mvebu-pinctrl",
                    "marvell,cp115-standalone-pinctrl";
       bank-name ="cp1-110";

       /* MPP Bus:
	*	[3:2]	xmdio
	*	[5:4]	mdio
	*	[36:35]	i2c1
	*	[43:40]	rs232
	*/
               /*      0    1    2    3    4    5    6    7    8    9 */
       pin-func = <    0x0  0x0  0xa  0xa  0xa  0xa  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0  0x0  0x0	0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0  0x0  0x0  0x2  0x2  0x0  0x0  0x0
                       0x7  0x7  0x7  0x7  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0  0x0
                       0x0  0x0  0x0 >;

	cp1_i2c1_pins: cp1-i2c-pins-1 {
		marvell,pins = < 35 36 >;
		marvell,function = <2>;
	};
	cp1_xmdio_pins: cp1-xmdio-pins-0 {
               marvell,pins = < 2 3 >;
               marvell,function = <10>;
	};
	cp1_mdio_pins: cp1-mdio-pins-0 {
               marvell,pins = < 4 5 >;
               marvell,function = <10>;
        };
	cp1_uart1_pins: cp1-uart1-pins-0 {
               marvell,pins = < 40 41 42 43 >;
               marvell,function = <7>;
        };
};

/* SATA0  */
&cp1_sata0 {
       status = "disabled";
};

&cp1_ethernet {
        status = "okay";
};

/* SRDS #0 - PCIe Extenssion card */
&cp1_pcie0 {
	pinctrl-names = "default";
        num-lanes = <1>;
        status = "okay";
	ranges = <0x82000000 0 0xe2000000 0 0xe2000000 0 0xf00000>;
};

/* SRDS #1 - USB Extenssion card */
&cp1_usb3_0 {
        status = "okay";
        vbus-supply = <&cp1_reg_usb3_vbus0>;
};

/* SRDS #2 - 10GE SFP+ */
&cp1_eth0 {
        status = "okay";
        phy-mode = "sfi";
        compatible = "sff,sfp";

        /* for SFP direct connectivity */
//      i2c-bus = <i2c_sfp1>;
//      mod-def0-gpio = <&cp1_gpio1 18 GPIO_ACTIVE_LOW>; //MPP50
//	compatible = "sff,sfp";
//	maximum-power-milliwatt = <2000>;

        /* MBV-A BCM PHY  | MBV-B VSC Microchip PHY */
        phy = <&cp1_sfi_phy9>; //address 0x01001

};

/* SRDS #3 - not in use */


/* SRDS #4 - mPCIe */
&cp1_pcie1 {
        num-lanes = <1>;
        status = "okay";
};

/* SRDS #5 - mPCIe */
&cp1_pcie2 {
        num-lanes = <1>;
        status = "okay";
};

/*************** definitions of addresses for cp0 eth ports ************/

&cp0_eth0 {
        status = "okay";
	phy = <&cp0_sfi_phy8>; //address 0x01000
};

&cp0_eth1 {
        status = "okay";
        phy = <&cp0_vsc_phy18>; //address 0x0011000
};

&cp0_eth2 {
        status = "okay";
        phy = <&cp0_vsc_phy19>; //address 0x0011001
};
